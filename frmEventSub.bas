Version =20
VersionRequired =20
Begin Form
    RecordSelectors = NotDefault
    NavigationButtons = NotDefault
    ScrollBars =0
    TabularCharSet =204
    PictureAlignment =2
    DatasheetGridlinesBehavior =3
    GridX =24
    GridY =24
    Width =10320
    DatasheetFontHeight =11
    ItemSuffix =42
    Right =18075
    Bottom =9900
    DatasheetGridlinesColor =15062992
    RecSrcDt = Begin
        0xa96b3cf20b0ae540
    End
    RecordSource ="qryEventDates"
    DatasheetFontName ="Calibri"
    PrtMip = Begin
        0x6801000068010000680100006801000000000000201c0000e010000001000000 ,
        0x010000006801000000000000a10700000100000001000000
    End
    FilterOnLoad =0
    NavigationCaption ="Occurances"
    ShowPageMargins =0
    DisplayOnSharePointSite =1
    AllowLayoutView =0
    DatasheetAlternateBackColor =16053492
    DatasheetGridlinesColor12 =15062992
    FitToScreen =1
    Begin
        Begin Label
            BackStyle =0
            FontSize =11
            FontName ="Calibri"
        End
        Begin CommandButton
            FontSize =11
            FontWeight =400
            ForeColor =-2147483630
            FontName ="Calibri"
            BorderLineStyle =0
        End
        Begin CheckBox
            SpecialEffect =2
            BorderLineStyle =0
            LabelX =230
            LabelY =-30
        End
        Begin TextBox
            FELineBreak = NotDefault
            BorderLineStyle =0
            LabelX =-1800
            FontSize =11
            BorderColor =12632256
            FontName ="Calibri"
            AsianLineBreak =1
        End
        Begin FormHeader
            Height =390
            BackColor =9732411
            Name ="FormHeader"
            Begin
                Begin Label
                    Visible = NotDefault
                    OverlapFlags =93
                    Left =60
                    Top =60
                    Width =840
                    Height =270
                    FontWeight =700
                    ForeColor =16777215
                    Name ="Label4"
                    Caption ="Instance"
                    LayoutCachedLeft =60
                    LayoutCachedTop =60
                    LayoutCachedWidth =900
                    LayoutCachedHeight =330
                End
                Begin Label
                    OverlapFlags =215
                    Left =660
                    Top =60
                    Width =1545
                    Height =285
                    FontWeight =700
                    ForeColor =16777215
                    Name ="Label5"
                    Caption ="Next Due Date"
                    LayoutCachedLeft =660
                    LayoutCachedTop =60
                    LayoutCachedWidth =2205
                    LayoutCachedHeight =345
                End
                Begin CommandButton
                    OverlapFlags =85
                    Left =3060
                    Top =60
                    Width =780
                    Height =300
                    FontSize =10
                    Name ="Command38"
                    Caption ="Undo "
                    OnClick ="[Event Procedure]"
                    PictureData = Begin
                        0x2800000010000000100000000100040000000000800000000000000000000000 ,
                        0x0000000000000000000000000000800000800000008080008000000080008000 ,
                        0x8080000080808000c0c0c0000000ff00c0c0c00000ffff00ff000000c0c0c000 ,
                        0xffff0000ffffff00dddddddddddddddddddddddddddddddddddddddddddddddd ,
                        0xddddddddddddddddddddddddddddddddddddddddddd74ddddd44444ddddd47dd ,
                        0xdd4444ddddddd4dddd444dddddddd4dddd44d4ddddddd4dddd4ddd44dddd47dd ,
                        0xdddddddd44447ddddddddddddddddddddddddddddddddddddddddddddddddddd ,
                        0xdddddddddddddddd000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000
                    End
                    ObjectPalette = Begin
                        0x000301000000000000000000
                    End

                    LayoutCachedLeft =3060
                    LayoutCachedTop =60
                    LayoutCachedWidth =3840
                    LayoutCachedHeight =360
                    PictureCaptionArrangement =5
                    WebImagePaddingLeft =2
                    WebImagePaddingTop =2
                    WebImagePaddingRight =1
                    WebImagePaddingBottom =1
                    Overlaps =1
                End
                Begin CommandButton
                    OverlapFlags =85
                    Left =3960
                    Top =60
                    Width =840
                    Height =300
                    FontSize =10
                    TabIndex =1
                    Name ="Command39"
                    Caption ="Skip"
                    OnClick ="[Event Procedure]"
                    PictureData = Begin
                        0x2800000010000000100000000100040000000000800000000000000000000000 ,
                        0x0000000000000000000000000000800000800000008080008000000080008000 ,
                        0x8080000080808000c0c0c0000000ff00c0c0c00000ffff00ff000000c0c0c000 ,
                        0xffff0000ffffff00dddddddddddddddddddddddddddddddddddddddddddddddd ,
                        0xdddddddddddddddddddddcddddd44ddddddddccdddd44ddddddddcccddd44ddd ,
                        0xdddddccccdd44ddddddddcccccd44ddddddddccccdd44ddddddddcccddd44ddd ,
                        0xdddddccdddd44ddddddddcddddd44ddddddddddddddddddddddddddddddddddd ,
                        0xdddddddddddddddd000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000
                    End
                    ObjectPalette = Begin
                        0x000301000000000000000000
                    End

                    LayoutCachedLeft =3960
                    LayoutCachedTop =60
                    LayoutCachedWidth =4800
                    LayoutCachedHeight =360
                    PictureCaptionArrangement =5
                    WebImagePaddingLeft =2
                    WebImagePaddingTop =2
                    WebImagePaddingRight =1
                    WebImagePaddingBottom =1
                    Overlaps =1
                End
            End
        End
        Begin Section
            Height =540
            Name ="Detail"
            Begin
                Begin TextBox
                    Visible = NotDefault
                    OverlapFlags =93
                    IMESentenceMode =3
                    Left =9360
                    Top =60
                    Width =960
                    Height =315
                    TabIndex =4
                    LeftMargin =144
                    BorderColor =14211288
                    Name ="InstanceComment"
                    ControlSource ="InstanceComment"
                    StatusBarText ="Why this was cancelled/rescheduled. 255-char max."

                    LayoutCachedLeft =9360
                    LayoutCachedTop =60
                    LayoutCachedWidth =10320
                    LayoutCachedHeight =375
                End
                Begin TextBox
                    Visible = NotDefault
                    TabStop = NotDefault
                    AllowAutoCorrect = NotDefault
                    OldBorderStyle =0
                    OverlapFlags =93
                    IMESentenceMode =3
                    Top =60
                    Width =723
                    Height =420
                    FontSize =14
                    RightMargin =144
                    BorderColor =14211288
                    Name ="InstanceID"
                    ControlSource ="InstanceID"
                    StatusBarText ="Unique number. (Used for Cartesian product queries.)"

                    LayoutCachedTop =60
                    LayoutCachedWidth =723
                    LayoutCachedHeight =480
                End
                Begin TextBox
                    OldBorderStyle =0
                    OverlapFlags =247
                    IMESentenceMode =3
                    Left =480
                    Top =60
                    Width =1806
                    Height =420
                    FontSize =14
                    TabIndex =2
                    RightMargin =144
                    BorderColor =14211288
                    Name ="EventDate"
                    ControlSource ="EventDate"
                    ConditionalFormat = Begin
                        0x0100000090000000010000000100000000000000000000001700000001010000 ,
                        0x1f497d00ffffff00000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x5b0049007300430061006e006e00650064005d0020004900730020004e006f00 ,
                        0x740020004e0075006c006c0000000000
                    End
                    ShowDatePicker =0

                    LayoutCachedLeft =480
                    LayoutCachedTop =60
                    LayoutCachedWidth =2286
                    LayoutCachedHeight =480
                    ConditionalFormat14 = Begin
                        0x0100010000000100000000000000010100001f497d00ffffff00160000005b00 ,
                        0x49007300430061006e006e00650064005d0020004900730020004e006f007400 ,
                        0x20004e0075006c006c00000000000000000000000000000000000000000000
                    End
                End
                Begin CommandButton
                    OverlapFlags =85
                    Left =2700
                    Top =60
                    Width =2400
                    Height =420
                    FontSize =12
                    TabIndex =1
                    Name ="Command30"
                    Caption ="Choose File"
                    OnClick ="[Event Procedure]"

                    LayoutCachedLeft =2700
                    LayoutCachedTop =60
                    LayoutCachedWidth =5100
                    LayoutCachedHeight =480
                    WebImagePaddingLeft =2
                    WebImagePaddingTop =2
                    WebImagePaddingRight =1
                    WebImagePaddingBottom =1
                    Overlaps =1
                End
                Begin TextBox
                    Visible = NotDefault
                    Locked = NotDefault
                    TabStop = NotDefault
                    OverlapFlags =95
                    TextFontCharSet =2
                    TextAlign =2
                    TextFontFamily =2
                    IMESentenceMode =3
                    Left =9060
                    Top =60
                    Width =297
                    Height =315
                    FontSize =12
                    TabIndex =3
                    BorderColor =0
                    ForeColor =3751056
                    Name ="IsCanned"
                    ControlSource ="IsCanned"
                    Format =";\\û"
                    StatusBarText ="Check the box if this instance is cancelled. Required."
                    FontName ="Wingdings"

                    LayoutCachedLeft =9060
                    LayoutCachedTop =60
                    LayoutCachedWidth =9357
                    LayoutCachedHeight =375
                End
                Begin CommandButton
                    Visible = NotDefault
                    OverlapFlags =93
                    TextFontCharSet =204
                    Left =6780
                    Width =420
                    Height =300
                    FontSize =10
                    TabIndex =5
                    Name ="cmdEdit"
                    Caption ="Edit"
                    OnClick ="[Event Procedure]"

                    LayoutCachedLeft =6780
                    LayoutCachedWidth =7200
                    LayoutCachedHeight =300
                    WebImagePaddingLeft =2
                    WebImagePaddingTop =2
                    WebImagePaddingRight =1
                    WebImagePaddingBottom =1
                    Overlaps =1
                End
                Begin CheckBox
                    Visible = NotDefault
                    OverlapFlags =215
                    Left =7080
                    Top =60
                    Width =360
                    TabIndex =7
                    Name ="Check32"
                    ControlSource ="Complete?"
                    DefaultValue ="=False"

                    LayoutCachedLeft =7080
                    LayoutCachedTop =60
                    LayoutCachedWidth =7440
                    LayoutCachedHeight =300
                End
                Begin TextBox
                    Visible = NotDefault
                    OldBorderStyle =0
                    OverlapFlags =93
                    IMESentenceMode =3
                    Left =7440
                    Width =720
                    Height =300
                    TabIndex =6
                    BackColor =15523798
                    Name ="Text36"
                    ControlSource ="ActualHours"

                    LayoutCachedLeft =7440
                    LayoutCachedWidth =8160
                    LayoutCachedHeight =300
                End
                Begin TextBox
                    Visible = NotDefault
                    OverlapFlags =247
                    IMESentenceMode =3
                    Left =7920
                    Width =1296
                    Height =315
                    TabIndex =8
                    RightMargin =144
                    BorderColor =14211288
                    Name ="Text35"
                    ControlSource ="EventID"
                    ConditionalFormat = Begin
                        0x0100000090000000010000000100000000000000000000001700000001010000 ,
                        0x1f497d00ffffff00000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x5b0049007300430061006e006e00650064005d0020004900730020004e006f00 ,
                        0x740020004e0075006c006c0000000000
                    End
                    ShowDatePicker =0

                    LayoutCachedLeft =7920
                    LayoutCachedWidth =9216
                    LayoutCachedHeight =315
                    ConditionalFormat14 = Begin
                        0x0100010000000100000000000000010100001f497d00ffffff00160000005b00 ,
                        0x49007300430061006e006e00650064005d0020004900730020004e006f007400 ,
                        0x20004e0075006c006c00000000000000000000000000000000000000000000
                    End
                End
            End
        End
        Begin FormFooter
            Height =0
            Name ="FormFooter"
        End
    End
End
CodeBehindForm
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Compare Database
Option Explicit
Private Const conMod = "Form_frmEventSub"
Private Declare Function GetUserName Lib "advapi32.dll" Alias "GetUserNameA" (ByVal lpBuffer As String, nSize As Long) As Long
Function UserNameWindows() As String
    Dim lngLen As Long
    Dim strBuffer As String
   
    Const dhcMaxUserName = 255
   
    strBuffer = Space(dhcMaxUserName)
    lngLen = dhcMaxUserName
    If CBool(GetUserName(strBuffer, lngLen)) Then
        UserNameWindows = Left$(strBuffer, lngLen - 1)
    Else
        UserNameWindows = ""
    End If
End Function

Private Sub txtCancelReset_Click()
On Error GoTo Err_Handler
    'Purpose:
    Dim Db As DAO.Database
    Dim strMsg As String
    Dim strSQL As String

    If Me.IsCanned.Value Then
        strMsg = "Reset instance " & Me.InstanceID & " of Event " & Me.EventID & " to the default date?"
        strSQL = "DELETE FROM tblEventException WHERE ((EventID = " & Me.EventID & ") AND (InstanceID = " & Me.InstanceID & "));"
    Else
        strMsg = "Cancel instance " & Me.InstanceID & " of Event " & Me.EventID & "?"
        If IsNull(Me.IsCanned) Then
            strSQL = "INSERT INTO tblEventException"
        Else
            strSQL = "UPDATE tblEventException SET IsCanned = TRUE WHERE ((EventID = " & Me.EventID & ") AND (InstanceID = " & Me.InstanceID & "));"
        End If
    End If
    
    If MsgBox(strMsg, vbYesNo + vbQuestion, "Confirm") = vbYes Then
        
    End If
    
Exit_Handler:
    Exit Sub
    
Err_Handler:
    Call LogError(Err.Number, Err.Description, conMod & ".txtCancelRestore_Click")
    Resume Exit_Handler
End Sub

Private Sub cmdEdit_Click()
On Error GoTo Err_Handler
    'Purpose:
    Dim strWhere As String
        
    If IsNull(Me.EventID) Or IsNull(Me.InstanceID) Then
        MsgBox "Unable to determine the entry to edit.", vbExclamation, "Cannot edit record."
    Else
        strWhere = "(EventID = " & Nz(Me.EventID, 0) & ") AND (InstanceID = " & Nz(Me.InstanceID, 0) & ")"
        DoCmd.OpenForm "frmEventException", WhereCondition:=strWhere, WindowMode:=acDialog
    End If

Exit_Handler:
    Exit Sub
    
Err_Handler:
    Call LogError(Err.Number, Err.Description, conMod & ".cmdEdit_Click")
    Resume Exit_Handler
End Sub
'Submit button to save documents to sharepoint
Private Sub Command30_Click()
Dim fd As FileDialog, fileName As String
Dim Db As Database
Dim db1 As Database
Dim r As Recordset
Dim rs As DAO.Recordset
Dim SharepointAddress As String
Dim LocalAddress As String
Dim NowDate As String, DueMonth As Integer
Dim objNet As Object
Dim FS As Object
Dim FileExt As String
Dim selectFile As String
Dim sqlquery As String
On Error GoTo Err_Handler
     ' Dimension variables
     Dim lpBuff As String * 25
     Dim ret As Long, UserName As String

     ' Get the user name minus any trailing spaces found in the name.
     ret = GetUserName(lpBuff, 25)
     UserName = Left(lpBuff, InStr(lpBuff, Chr(0)) - 1)
 
Set Db = CurrentDb()
Set fd = Application.FileDialog(msoFileDialogOpen)
 
fd.AllowMultiSelect = False
 
If fd.Show = True Then
    If fd.SelectedItems(1) <> vbNullString Then
        fileName = fd.SelectedItems(1)
    End If
Else
    'Exit code if no file is selected
    End
End If
 
'This references the Event due date
NowDate = Me.EventDate
'NowDate = Forms![EquipForm]![EventDate]
'Grabs the month from the date as an integer
DueMonth = month(NowDate)
 
FileExt = Right(fileName, Len(fileName) - InStrRev(fileName, "."))
'Return Selected FileName
selectFile = Format(NowDate, "yyyymm") & "_" & Forms![EquipForm]![DocumentName] & "." & FileExt

sqlquery = "SELECT * FROM MERM " & _
"WHERE Attachment = Forms![EquipForm]![Attachment];"
SharepointAddress = Forms![EquipForm]![Attachment] & "\"
LocalAddress = fileName

Set fd = Nothing

Set objNet = CreateObject("WScript.Network")
Set FS = CreateObject("Scripting.FileSystemObject")
If FS.FileExists(LocalAddress) Then
FS.CopyFile LocalAddress, SharepointAddress & selectFile
End If

Set objNet = Nothing
Set FS = Nothing
MsgBox "Success! File was uploaded to the MERM:" & vbCrLf & selectFile, vbInformation, "Upload Complete"
      
 ' this passes the integer to mark the item complete
'tblSubmissions.[Complete?] = True

'Write a new record to the sumbissions table
Set db1 = CurrentDb
Set rs = db1.OpenRecordset("tblSubmissions")
rs.AddNew
rs("EventID").Value = Me.EventID
rs("InstanceID").Value = Me.InstanceID
rs("EventDate").Value = Me.EventDate
rs("Complete").Value = True
rs("DocumentName").Value = Me.DocumentName
rs("SubmittedBy") = UserName
rs.Update
Dim strWhere As String
        
    If IsNull(Me.EventID) Or IsNull(Me.InstanceID) Then
        MsgBox "Unable to determine the entry to edit.", vbExclamation, "Cannot edit record."
    Else
        strWhere = "(EventID = " & Nz(Me.EventID, 0) & ") AND (InstanceID = " & Nz(Me.InstanceID, 0) & ")"
        DoCmd.OpenForm "frmEventException", WhereCondition:=strWhere, WindowMode:=acHidden
        Forms!frmEventException.Check12.Value = True
        DoCmd.Close
    End If
'Refresh query on home page
Forms!MERMHome!PendingDue.Form.Requery


Me.Requery
Forms!EquipForm!ID1.SetFocus


'Hide the record
'Me.frmEventSub!InstanceID.Visible = No
 
'Save the record
'DoCmd.RunCommand acCmdSaveRecord

'Close the form
' DoCmd.Close
Exit Sub

Exit_Handler:
    Exit Sub
Err_Handler:
Set fd = Nothing
    Call LogError(Err.Number, Err.Description, conMod & ".cmdCancel_Click")
    Resume Exit_Handler
'End Function
End Sub
'Undo Button
Private Sub Command38_Click()
Dim eventlog As String, submitlog As String
Dim i As Variant
i = -1
submitlog = "DELETE FROM tblSubmissions where InstanceID = " & (InstanceID - 1) & " AND EventID = " & Me.EventID & ";"
eventlog = "DELETE FROM tblEventException where InstanceID = " & (InstanceID - 1) & " AND EventID = " & Me.EventID & ";"

DoCmd.SetWarnings False
DoCmd.RunSQL eventlog
DoCmd.RunSQL submitlog
DoCmd.SetWarnings True
DoCmd.Requery
Me.Refresh
Forms!MERMHome!PendingDue.Form.Requery
End Sub
'Skip button
Private Sub Command39_Click()
Dim db2 As Database
Dim rs As DAO.Recordset
     ' Dimension variables
     Dim lpBuff As String * 25
     Dim ret As Long, UserName As String

     ' Get the user name minus any trailing spaces found in the name.
     ret = GetUserName(lpBuff, 25)
     UserName = Left(lpBuff, InStr(lpBuff, Chr(0)) - 1)
Set db2 = CurrentDb
Set rs = db2.OpenRecordset("tblSubmissions")
rs.AddNew
rs("EventID").Value = Me.EventID
rs("InstanceID").Value = Me.InstanceID
rs("EventDate").Value = Me.EventDate
rs("Complete").Value = True
rs("DocumentName").Value = Me.DocumentName
rs("SkippedBy") = UserName
rs.Update

Dim strWhere As String
        
    If IsNull(Me.EventID) Or IsNull(Me.InstanceID) Then
        MsgBox "Unable to determine the entry to edit.", vbExclamation, "Cannot edit record."
    Else
        strWhere = "(EventID = " & Nz(Me.EventID, 0) & ") AND (InstanceID = " & Nz(Me.InstanceID, 0) & ")"
        DoCmd.OpenForm "frmEventException", WhereCondition:=strWhere, WindowMode:=acHidden
        Forms!frmEventException.Check12.Value = True
        DoCmd.Close
    End If
    
DoCmd.Requery
Forms!MERMHome!PendingDue.Form.Requery

End Sub
